<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>
    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Jua&family=Poor+Story&display=swap');
    </style>
    <link href="../css/boardPage.css" rel="stylesheet" />
</head>
<body>
    <header>
      <div class="mytitle">
        <div>
          <h3 class="titleName">6사시미</h3>
        </div>
      </div>
        <div>
            <label><h3>boardName</h3></label>
            <button type="button" class="btn btn-info infoBtn" onclick="userInfo()">Info</button>
            <label><h3>boardContent</h3></label>
        </div>
    </header>
    <main>
        <div class="modal" id="modalNotAdmin">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title">User</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onclick="closeModal()"></button>
                </div>
                <div class="modal-body">
                  <div class="mb-3 row">
                    <label for="nickname" class="col-sm-2 col-form-label">nickname</label>
                    <div class="col-sm-10">
                        <input type="text" readonly class="form-control-plaintext" id="nickname" value="nickname">
                      </div>
                  </div>
                  <div class="mb-3 row">
                    <label for="nickname" class="col-sm-2 col-form-label">참여자</label>
                  </div>
                  <div class="mb-3 row members">
                    <div class="col-sm-10 member">
                        <img src="../image/cat.jpg" style="width: 100px; height: 100px; border-radius: 50px;" />
                        <input type="text" readonly class="form-control-plaintext" id="nickname" value="nickname1">
                    </div>
                    <div class="col-sm-10 member">
                        <img src="../image/cat.jpg" style="width: 100px; height: 100px; border-radius: 50px;" />
                        <input type="text" readonly class="form-control-plaintext" id="nickname" value="nickname1">
                    </div>
                  </div>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="closeModal()">Close</button>
                  <button type="button" class="btn btn-primary" onclick="myPage()">my Page</button>
                </div>
              </div>
            </div>
          </div>
          <div class="modal" id="modalAdmin">
            <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title">User</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onclick="closeAdminModal()"></button>
                  </div>
                  <div class="modal-body">
                    <div class="mb-3 row">
                      <label for="nickname" class="col-sm-2 col-form-label">nickname</label>
                      <div class="col-sm-10">
                          <input type="text" readonly class="form-control-plaintext" id="nickname" value="nickname">
                        </div>
                    </div>
                    <div class="mb-3 row">
                      <label for="nickname" class="col-sm-2 col-form-label">참여자</label>
                    </div>
                    <div class="mb-3 row members">
                      <div class="col-sm-10 member">
                          <img src="../image/cat.jpg" style="width: 100px; height: 100px; border-radius: 50px;" />
                          <input type="text" readonly class="form-control-plaintext" id="nickname" value="nickname1">
                      </div>
                      <div class="col-sm-10 member">
                          <img src="../image/cat.jpg" style="width: 100px; height: 100px; border-radius: 50px;" />
                          <input type="text" readonly class="form-control-plaintext" id="nickname" value="nickname1">
                      </div>
                      <div class="col-sm-10 member">
                        <button type="button" class="btn btn-secondary" onclick="memberInvite()">member invite</button>
                    </div>
                    </div>
                    <div class="mb-3 row backgroundColor">
                        <label for="backgroundColor" class="col-sm-2 col-form-label">색상</label>
                        <!-- 색상 리스트자리 -->
                        <input type="color" style="width: 200px; margin: 10px auto auto auto;" class="form-control" id="backgroundColor">
                        <button type="button" class="btn btn-info" style="width: 100px; margin: 10px auto auto auto;">저장</button>
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="closeAdminModal()">Close</button>
                    <button type="button" class="btn btn-primary" onclick="myPage()">my Page</button>
                    <button type="button" class="btn btn-danger">보드 삭제</button>
                  </div>
                </div>
              </div>
          </div>
          <div class="modal" id="modalColumnCreate">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title">Column create</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onclick="closeColumnModal()"></button>
                </div>
                <div class="modal-body">
                  <div class="mb-3 row">
                    <label for="columnName" class="col-sm-2 col-form-label">name</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="columnName">
                      </div>
                  </div>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="closeColumnModal()">Close</button>
                  <button type="button" class="btn btn-primary">column 생성</button>
                </div>
              </div>
            </div>
          </div>
          <div class="modal" id="modalCardCreate">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title">Card create</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onclick="closeCardModal()"></button>
                </div>
                <div class="modal-body">
                  <div class="mb-3 row">
                    <label for="cardTitle" class="col-sm-2 col-form-label">제목</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="cardTitle">
                      </div>
                  </div>
                  <div class="mb-3 row">
                    <label for="cardContent" class="col-sm-2 col-form-label">설명</label>
                    <div class="col-sm-10">
                        <textarea class="form-control" id="cardContent" rows="3"></textarea>
                      </div>
                  </div>
                  <div class="mb-3 row">
                    <label for="cardColor" class="col-sm-2 col-form-label">색상</label>
                    <!-- 색상 리스트자리 -->
                    <input type="color" class="form-control" id="cardColor">
                  </div>
                  <div class="mb-3 row">
                    <label for="cardDate" class="col-sm-2 col-form-label">마감일자</label>
                    <!-- 마감일자 자리 아래 사이트 참고하려고 함-->
                    <!-- https://programmer93.tistory.com/5#google_vignette -->
                    <input type="date" class="form-control" id="expiredDate">
                  </div>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="closeCardModal()">Close</button>
                  <button type="button" class="btn btn-primary">생성</button>
                </div>
              </div>
            </div>
          </div>
        <div class="d-flex flex-wrap justify-content-around columnBox">
            <div draggable="true" class="column m-9">
                <div>
                    <input type="text" class="form-control" id="columnName" value="columnName1">
                    <button type="button" class="btn btn-info">수정</button>
                    <button type="button" class="btn btn-danger">삭제</button>
                </div>
                <div draggable="true" class="cardBox">
                    <div draggable="true" class="card">
                        <input type="text" readonly class="form-control-plaintext" id="cardName" value="cardName1">
                    </div>
                </div>
                <button type="button" class="btn btn-secondary" onclick="createCard()">card +</button>
            </div>
            <div draggable="true" class="column m-9">
                <div>
                    <input type="text" class="form-control" id="columnName" value="columnName2">
                    <button type="button" class="btn btn-info">수정</button>
                    <button type="button" class="btn btn-danger">삭제</button>
                </div>
                <div draggable="true" class="cardBox">
                </div>
                <button type="button" class="btn btn-secondary" onclick="createCard()">card +</button>
            </div>
            <div draggable="true" class="column m-9">
                <div>
                    <input type="text" class="form-control" id="columnName" value="columnName3">
                    <button type="button" class="btn btn-info">수정</button>
                    <button type="button" class="btn btn-danger">삭제</button>
                </div>
                <div draggable="true" class="cardBox">
                    <div draggable="true" class="card">
                        <input type="text" readonly class="form-control-plaintext" id="cardName" value="cardName2">
                    </div>
                    <div draggable="true" class="card">
                        <input type="text" readonly class="form-control-plaintext" id="cardName" value="cardName3">
                    </div>
                </div>
                <button type="button" class="btn btn-secondary" onclick="createCard()">card +</button>
            </div>
        </div>
        
        <div>
            <button type="button" class="btn btn-secondary columnBtn" onclick="columnCreate()">column +</button>
        </div>
    </main>
    <script>
        function userInfo(){
            //req?에 저장된 user정보를 가지고 db에서 board를 찾아 비교해서 사용
        //   if($('#modalNotAdmin').css('display') == 'none'){
        //     $('#modalNotAdmin').show();
        //   }
        if($('#modalAdmin').css('display') == 'none'){
            $('#modalAdmin').show();
          }
        }
  
        function closeModal(){
          if($('#modalNotAdmin').css('display') != 'none'){
            $('#modalNotAdmin').hide();
          }
        }

        function closeAdminModal(){
          if($('#modalAdmin').css('display') != 'none'){
            $('#modalAdmin').hide();
          }
        }
        function myPage(){
            window.location.replace('./myPage.html');
        }

        function memberInvite() {
            window.location.replace('./invitePage.html');
        }

        function columnCreate() {
          if($('#modalColumnCreate').css('display') == 'none'){
            $('#modalColumnCreate').show();
          }
        }

        function closeColumnModal() {
            if($('#modalColumnCreate').css('display') != 'none'){
                $('#modalColumnCreate').hide();
            }
        }
        
        function createCard() {
          if($('#modalCardCreate').css('display') == 'none'){
            $('#modalCardCreate').show();
          }
        }

        function closeCardModal() {
            if($('#modalCardCreate').css('display') != 'none'){
                $('#modalCardCreate').hide();
            }
        }

        //컬럼 드래그
        const columnDraggables = document.querySelectorAll('.column');
        const boardContainer = document.querySelectorAll(".columnBox");

        columnDraggables.forEach(draggable => {
            draggable.addEventListener("dragstart", () => {
                draggable.classList.add("dragging");
            });

            draggable.addEventListener("dragend", () => {
                draggable.classList.remove("dragging");
            });
        });
        boardContainer.forEach(container => {
            container.addEventListener("dragover", e => {
                e.preventDefault();
                const afterElement = getDragAfterElement(container, e.clientX);
                const draggable = document.querySelector(".dragging");
                if (afterElement === undefined) {
                container.appendChild(draggable);
                } else {
                container.insertBefore(draggable, afterElement);
                }
            });
        });
        function getDragAfterElement(container, x) {
            const draggableElements = [
                ...container.querySelectorAll(".column:not(.dragging)"),
            ];

            return draggableElements.reduce(
                (closest, child) => {
                    const box = child.getBoundingClientRect();
                    const offset = x - box.left - box.width /2;

                    if(offset < 0 && offset > closest.offset) {
                        return {offset:offset, element:child}
                    }else {
                        return closest;
                    }
                },
                {offset: Number.NEGATIVE_INFINITY},
            ).element;
        }

        //카드 드래그
        const cardDraggables = document.querySelectorAll('.card');
        const cardContainer = document.querySelectorAll(".cardBox");

        cardDraggables.forEach(draggable => {
            draggable.addEventListener("dragstart", () => {
                draggable.classList.add("dragging2");
            });

            draggable.addEventListener("dragend", () => {
                draggable.classList.remove("dragging2");
            });
        });
        cardContainer.forEach(container => {
            container.addEventListener("dragover", e => {
                e.preventDefault();
                const afterElement = getDragAfterElement(container, e.clientX);
                const draggable = document.querySelector(".dragging2");
                if (afterElement === undefined) {
                container.appendChild(draggable);
                } else {
                container.insertBefore(draggable, afterElement);
                }
            });
        });
        function getDragAfterElement(container, x) {
            const draggableElements = [
                ...container.querySelectorAll(".column:not(.dragging2)"),
            ];

            return draggableElements.reduce(
                (closest, child) => {
                    const box = child.getBoundingClientRect();
                    const offset = x - box.left - box.width /2;

                    if(offset < 0 && offset > closest.offset) {
                        return {offset:offset, element:child}
                    }else {
                        return closest;
                    }
                },
                {offset: Number.NEGATIVE_INFINITY},
            ).element;
        }
      </script>
</body>
</html>